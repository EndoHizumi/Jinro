<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="utf-8">
        <title>index.html</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    </head>

    <body>
        <form id="the-form" action="JinrouResponcer.php" method="POST">
            名前：
            <input type="text" name="name">
            <BR>category:
            <BR>
            <input type="radio" name="category" value="ready">Ready
            <input type="radio" name="category" value="standby">Standby
            <input type="radio" name="category" value="start">start
            <input type="radio" name="category" value="restart">restart
            <input type="radio" name="category" value="nextDay">nextDay
            <input type="radio" name="category" value="quit">quit
            <input type="radio" name="category" value="end">end
            <input type="radio" name="category" value="vote">vote
            <input type="radio" name="category" value="expel">expel
            <input type="radio" name="category" value="attack">attack
            <input type="radio" name="category" value="open">open
            <input type="radio" name="category" value="mystic">mystic
            <input type="radio" name="category" value="guard">guard
            <br>
            <button>Submit</button>

        </form>
        <div id="result">
            <br>############ console ############
            <br>
        </div>
        <script>
            jQuery(function($) {
                var es = new EventSource('http://localhost:88/Broadcast.php');
                es.onmessage = function(event) {
                    console.log(event);
                    var jdata = $.parseJSON(event.data);
                    $("#result").append(jdata.ID + " " + jdata.Name + " " + jdata.Event + " receive time " + clock() + " send time " + jdata.time + "<br>");
                };

                function clock() {
                    var now = new Date();

                    var year = now.getFullYear();
                    var month = now.getMonth() + 1;
                    var date = now.getDate();
                    var hour = now.getHours(); // 時
                    var min = now.getMinutes(); // 分
                    var sec = now.getSeconds(); // 秒

                    // 数値が1桁の場合、頭に0を付けて2桁で表示する指定
                    if (hour < 10) {
                        hour = "0" + hour;
                    }
                    if (min < 10) {
                        min = "0" + min;
                    }
                    if (sec < 10) {
                        sec = "0" + sec;
                    }
                    var watch1 = hour + ':' + min + ':' + sec;
                    console.log(watch1);
                    var watch2 = year + '年' + month + '月' + date + '日';
                    return watch2 + " " + watch1;
                }

                $('#the-form').submit(function(event) {
                    // HTMLでの送信をキャンセル
                    event.preventDefault();

                    // 操作対象のフォーム要素を取得
                    var $form = $(this);

                    // 送信ボタンを取得
                    // （後で使う: 二重送信を防止する。）
                    var $button = $form.find('button');

                    // 送信
                    $.ajax({
                        url: $form.attr('action'),
                        type: $form.attr('method'),
                        data: $form.serialize() +
                            '&delay=1', // （デモ用に入力値をちょいと操作します）
                        timeout: 10000, // 単位はミリ秒

                        // 送信前
                        beforeSend: function(xhr, settings) {
                            // ボタンを無効化し、二重送信を防止
                            $button.attr('disabled', true);
                        },
                        // 応答後
                        complete: function(xhr, textStatus) {
                            // ボタンを有効化し、再送信を許可
                            $button.attr('disabled', false);
                        },

                        // 通信成功時の処理
                        success: function(result, textStatus, xhr) {
                            // 入力値を初期化
                            if (result) {
                                $("#result").append(result + " " + clock() + "<br>");
                            }
                        },

                        // 通信失敗時の処理
                        error: function(xhr, textStatus, error) {}
                    });
                });

                /*  // デモ用に入力値を設定
                  var $form = $('#the-form');
                  $form.find('[name=name]').val('名無しさん');
                  $form.find('[name=mail]').val('anonymouse@example.com');
                  $form.find('[name=sex][value=male]').prop('checked', true);
                  $form.find('[name=message]').val('こんにちはこんにちは！');*/
            });
        </script>
    </body>

</html>
